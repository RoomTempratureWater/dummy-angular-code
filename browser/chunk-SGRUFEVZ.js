import{a as nt}from"./chunk-B2JX3RTC.js";import{a as ot,b as at}from"./chunk-QWN6LCVA.js";import{a as vt}from"./chunk-TB7LB4U4.js";import"./chunk-7ZLDGE74.js";import{a as ct,c as lt,d as mt,f as st,g as pt,h as dt,i as ut,l as _t,m as ft,n as Ct}from"./chunk-67KY7TMX.js";import{a as rt}from"./chunk-LN23UZCV.js";import{$ as F,$a as tt,Aa as m,Ea as l,Fa as K,Ga as C,Ja as U,K as z,Ka as g,Ma as b,N,Na as A,O as y,Oa as Q,P as u,Q as _,S as H,Ta as X,Ua as T,Va as Y,Ya as Z,Z as O,_ as G,aa as n,bb as et,da as S,db as it,eb as V,fa as k,hb as I,i as $,ia as W,ib as E,k as w,ka as q,l as B,la as J,pa as h,qa as x,ra as D,sa as M,t as P,ta as L,ua as c,va as o,wa as r,xa as d,ya as v,za as f}from"./chunk-A36ACV2Y.js";import{c as R}from"./chunk-2VMXMS7J.js";var gt=(()=>{class e{constructor(){this.domSanitizer=y(tt)}transform(t){return R(this,null,function*(){let{marked:i}=yield import("./chunk-QKB3R2ER.js");return this.domSanitizer.sanitize(O.HTML,i.parse(t))||""})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275pipe=W({name:"markdown",type:e,pure:!0})}}return e})();var ht=e=>["/profile",e];function At(e,p){if(e&1){let t=v();o(0,"span",7)(1,"i",8),f("click",function(){u(t);let a=m(2);return _(a.delete.emit(!0))}),r()()}}function Et(e,p){if(e&1&&(o(0,"div",0)(1,"div",1)(2,"p",2),l(3),r()(),o(4,"div",3)(5,"a",4),d(6,"img",5),r(),l(7," \xA0 "),o(8,"a",4),l(9),r(),o(10,"span",6),l(11),b(12,"date"),r(),h(13,At,2,0,"span",7),b(14,"async"),r()()),e&2){let t=m();n(3),C(" ",t.comment.body," "),n(2),c("routerLink",g(12,ht,t.comment.author.username)),n(),c("src",t.comment.author.image,F),n(2),c("routerLink",g(14,ht,t.comment.author.username)),n(),C(" ",t.comment.author.username," "),n(2),C(" ",Q(12,7,t.comment.createdAt,"longDate")," "),n(2),x(A(14,10,t.canModify$)?13:-1)}}var xt=(()=>{class e{constructor(){this.delete=new J,this.canModify$=y(I).currentUser.pipe(w(t=>t?.username===this.comment.author.username))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=k({type:e,selectors:[["app-article-comment"]],inputs:{comment:"comment"},outputs:{delete:"delete"},decls:1,vars:1,consts:[[1,"card"],[1,"card-block"],[1,"card-text"],[1,"card-footer"],[1,"comment-author",3,"routerLink"],[1,"comment-author-img",3,"src"],[1,"date-posted"],[1,"mod-options"],[1,"ion-trash-a",3,"click"]],template:function(i,a){i&1&&h(0,Et,15,16,"div",0),i&2&&x(a.comment?0:-1)},dependencies:[V,Y,T],encapsulation:2})}}return e})();var yt=(()=>{class e{constructor(t){this.http=t}getAll(t){return this.http.get(`/articles/${t}/comments`).pipe(w(i=>i.comments))}add(t,i){return this.http.post(`/articles/${t}/comments`,{comment:{body:i}}).pipe(w(a=>a.comment))}delete(t,i){return this.http.delete(`/articles/${i}/comments/${t}`)}static{this.\u0275fac=function(i){return new(i||e)(N(Z))}}static{this.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var St=e=>["/editor",e],bt=e=>({disabled:e}),kt=()=>["/login"],Tt=()=>["/register"];function Vt(e,p){if(e&1){let t=v();o(0,"span")(1,"a",15),d(2,"i",16),l(3," Edit Article "),r(),o(4,"button",17),f("click",function(){u(t);let a=m(2);return _(a.deleteArticle())}),d(5,"i",18),l(6," Delete Article "),r()()}if(e&2){let t=m(2);n(),c("routerLink",g(2,St,t.article.slug)),n(3),c("ngClass",g(4,bt,t.isDeleting))}}function It(e,p){if(e&1){let t=v();o(0,"span")(1,"app-follow-button",19),f("toggle",function(a){u(t);let s=m(2);return _(s.toggleFollowing(a))}),r(),o(2,"app-favorite-button",20),f("toggle",function(a){u(t);let s=m(2);return _(s.onToggleFavorite(a))}),l(3),o(4,"span",21),l(5),r()()()}if(e&2){let t=m(2);n(),c("profile",t.article.author),n(),c("article",t.article),n(),C(" ",t.article.favorited?"Unfavorite":"Favorite"," Article "),n(2),C("(",t.article.favoritesCount,")")}}function Dt(e,p){if(e&1&&(o(0,"li",9),l(1),r()),e&2){let t=p.$implicit;n(),C(" ",t," ")}}function Mt(e,p){if(e&1){let t=v();o(0,"span")(1,"a",15),d(2,"i",16),l(3," Edit Article "),r(),o(4,"button",17),f("click",function(){u(t);let a=m(2);return _(a.deleteArticle())}),d(5,"i",18),l(6," Delete Article "),r()()}if(e&2){let t=m(2);n(),c("routerLink",g(2,St,t.article.slug)),n(3),c("ngClass",g(4,bt,t.isDeleting))}}function Lt(e,p){if(e&1){let t=v();o(0,"span")(1,"app-follow-button",19),f("toggle",function(a){u(t);let s=m(2);return _(s.toggleFollowing(a))}),r(),o(2,"app-favorite-button",20),f("toggle",function(a){u(t);let s=m(2);return _(s.onToggleFavorite(a))}),l(3),o(4,"span",21),l(5),r()()()}if(e&2){let t=m(2);n(),c("profile",t.article.author),n(),c("article",t.article),n(),C(" ",t.article.favorited?"Unfavorite":"Favorite"," Article "),n(2),C("(",t.article.favoritesCount,")")}}function Ut(e,p){if(e&1){let t=v();o(0,"div"),d(1,"app-list-errors",22),o(2,"form",23),f("ngSubmit",function(){u(t);let a=m(2);return _(a.addComment())}),o(3,"fieldset",24)(4,"div",25),d(5,"textarea",26),r(),o(6,"div",27),d(7,"img",28),o(8,"button",29),l(9," Post Comment "),r()()()()()}if(e&2){let t=m(2);n(),c("errors",t.commentFormErrors),n(2),c("disabled",t.isSubmitting),n(2),c("formControl",t.commentControl),n(2),c("src",(t.currentUser==null?null:t.currentUser.image)===null?"":t.currentUser==null?null:t.currentUser.image,F)}}function jt(e,p){e&1&&(o(0,"div")(1,"a",30),l(2,"Sign in"),r(),l(3," or "),o(4,"a",30),l(5,"sign up"),r(),l(6," to add comments on this article. "),r()),e&2&&(n(),c("routerLink",U(2,kt)),n(3),c("routerLink",U(3,Tt)))}function Rt(e,p){if(e&1){let t=v();o(0,"app-article-comment",31),f("delete",function(){let a=u(t).$implicit,s=m(2);return _(s.deleteComment(a))}),r()}if(e&2){let t=p.$implicit;c("comment",t)}}function $t(e,p){if(e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),l(4),r(),o(5,"app-article-meta",3),h(6,Vt,7,6,"span")(7,It,6,4,"span"),r()()(),o(8,"div",4)(9,"div",5)(10,"div",6),d(11,"div",7),b(12,"markdown"),b(13,"async"),o(14,"ul",8),M(15,Dt,2,1,"li",9,D),r()()(),d(17,"hr"),o(18,"div",10)(19,"app-article-meta",3),h(20,Mt,7,6,"span")(21,Lt,6,4,"span"),r()(),o(22,"div",11)(23,"div",12),q(24,Ut,10,4,"div",13)(25,jt,7,4,"div",13),M(26,Rt,1,1,"app-article-comment",14,D),r()()()()),e&2){let t=m();n(4),K(t.article.title),n(),c("article",t.article),n(),x(t.canModify?6:7),n(5),c("innerHTML",A(13,10,A(12,8,t.article.body)),G),n(4),L(t.article.tagList),n(4),c("article",t.article),n(),x(t.canModify?20:21),n(4),c("ifAuthenticated",!0),n(),c("ifAuthenticated",!1),n(),L(t.comments)}}var xe=(()=>{class e{constructor(t,i,a,s,wt){this.route=t,this.articleService=i,this.commentsService=a,this.router=s,this.userService=wt,this.comments=[],this.canModify=!1,this.commentControl=new pt("",{nonNullable:!0}),this.commentFormErrors=null,this.isSubmitting=!1,this.isDeleting=!1,this.destroyRef=y(H)}ngOnInit(){let t=this.route.snapshot.params.slug;B([this.articleService.get(t),this.commentsService.getAll(t),this.userService.currentUser]).pipe(P(i=>(this.router.navigate(["/"]),$(()=>i))),E(this.destroyRef)).subscribe(([i,a,s])=>{this.article=i,this.comments=a,this.currentUser=s,this.canModify=s?.username===i.author.username})}onToggleFavorite(t){this.article.favorited=t,t?this.article.favoritesCount++:this.article.favoritesCount--}toggleFollowing(t){this.article.author.following=t.following}deleteArticle(){this.isDeleting=!0,this.articleService.delete(this.article.slug).pipe(E(this.destroyRef)).subscribe(()=>{this.router.navigate(["/"])})}addComment(){this.isSubmitting=!0,this.commentFormErrors=null,this.commentsService.add(this.article.slug,this.commentControl.value).pipe(E(this.destroyRef)).subscribe({next:t=>{this.comments.unshift(t),this.commentControl.reset(""),this.isSubmitting=!1},error:t=>{this.isSubmitting=!1,this.commentFormErrors=t}})}deleteComment(t){this.commentsService.delete(t.id,this.article.slug).pipe(E(this.destroyRef)).subscribe(()=>{this.comments=this.comments.filter(i=>i!==t)})}static{this.\u0275fac=function(i){return new(i||e)(S(et),S(rt),S(yt),S(it),S(I))}}static{this.\u0275cmp=k({type:e,selectors:[["app-article-page"]],decls:1,vars:1,consts:[[1,"article-page"],[1,"banner"],[1,"container"],[3,"article"],[1,"container","page"],[1,"row","article-content"],[1,"col-md-12"],[3,"innerHTML"],[1,"tag-list"],[1,"tag-default","tag-pill","tag-outline"],[1,"article-actions"],[1,"row"],[1,"col-xs-12","col-md-8","offset-md-2"],[4,"ifAuthenticated"],[3,"comment"],[1,"btn","btn-sm","btn-outline-secondary",3,"routerLink"],[1,"ion-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click","ngClass"],[1,"ion-trash-a"],[3,"toggle","profile"],[3,"toggle","article"],[1,"counter"],[3,"errors"],[1,"card","comment-form",3,"ngSubmit"],[3,"disabled"],[1,"card-block"],["placeholder","Write a comment...","rows","3",1,"form-control",3,"formControl"],[1,"card-footer"],[1,"comment-author-img",3,"src"],["type","submit",1,"btn","btn-sm","btn-primary"],[3,"routerLink"],[3,"delete","comment"]],template:function(i,a){i&1&&h(0,$t,28,12,"div",0),i&2&&x(a.article?0:-1)},dependencies:[ot,V,X,vt,at,gt,T,Ct,_t,dt,ct,lt,mt,st,xt,ft,ut,nt],encapsulation:2})}}return e})();export{xe as default};
